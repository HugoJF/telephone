<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Telephone</title>
  </head>
  <body>
    <script type="text/javascript">
      var audioContext = new AudioContext();

      var worker = new Worker('worker.js');

      function playAudioSamples(samples, sampleRate) {
        //console.log(sampleRate);
        var audioBuffer = audioContext.createBuffer(1, samples.length, sampleRate);

        var audioData = audioBuffer.getChannelData(0);
        for (var i = 0; i < samples.length; i++) {
          audioData[i] = samples[i] / 0xFFFF;
        }

        var audioSource = audioContext.createBufferSource();
        audioSource.buffer = audioBuffer;

        audioSource.connect(audioContext.destination);
        audioSource.start();
      }

      worker.onmessage = function(e) {
        switch (e.data.type) {
          case 'audio-data':
            playAudioSamples(e.data.samples, e.data.sampleRate);
            break;
          default:
            console.log(e.data);
            break;
        }
      };

      worker.postMessage("ws://192.168.0.2:9000");
    </script>
  </body>
</html>
